<!-- Webinar Details Page - Cache Busted for Mobile -->
<script>
  // Prevent caching on mobile devices for this critical page
  if (typeof document !== 'undefined') {
    var meta = document.createElement('meta');
    meta.httpEquiv = 'Cache-Control';
    meta.content = 'no-cache, no-store, must-revalidate';
    document.getElementsByTagName('head')[0].appendChild(meta);
    
    console.log('üì± Webinar Details Page: Cache control applied for mobile');
  }
</script>

<div class="min-h-screen bg-gradient-to-b from-blue-900 to-blue-800">
  
  <!-- Loading State -->
  <div ng-if="isLoading" class="flex items-center justify-center py-20">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto"></div>
      <p class="text-white mt-4">Loading webinar details...</p>
    </div>
  </div>

  <!-- Error State -->
  <div ng-if="error && !isLoading" class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
    <div class="text-center">
      <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
        <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 6.5c-.77.833-.192 2.5 1.732 2.5z" />
        </svg>
      </div>
      <h2 class="text-2xl font-bold text-white mb-2">Webinar Not Found</h2>
      <p class="text-slate-300 mb-6">{{error}}</p>
      <button ng-click="goToDashboard()" class="bg-primary-600 hover:bg-primary-500 text-white px-6 py-3 rounded-lg font-medium transition-colors">
        Back to Dashboard
      </button>
    </div>
  </div>

  <!-- Webinar Content -->
  <div ng-if="webinar && !isLoading && !error" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Back Button -->
    <div class="mb-6">
      <button ng-click="goToDashboard()" 
              class="flex items-center text-slate-300 hover:text-white transition-colors">
        <svg class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to Dashboard
      </button>
    </div>
    
    <!-- Webinar Header -->
    <div class="bg-slate-800 rounded-xl p-6 mb-8 border border-slate-600">
      <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between">
        <div class="flex-1 mb-4 lg:mb-0">
          <div class="flex items-center mb-4">
            <h1 class="text-3xl font-bold text-white mr-4">{{webinar.title}}</h1>
            <span ng-class="{
              'bg-green-800 text-green-200': webinar.status === 'upcoming',
              'bg-red-800 text-red-200': webinar.status === 'live', 
              'bg-gray-800 text-gray-200': webinar.status === 'completed',
              'bg-yellow-800 text-yellow-200': webinar.status === 'cancelled'
            }" class="px-3 py-1 text-sm rounded-full font-medium">
              {{webinar.status | uppercase}}
            </span>
          </div>
          
          <p class="text-slate-300 text-lg mb-4">{{webinar.description}}</p>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
            <div class="flex items-center text-slate-300">
              <svg class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              {{formatDateTime(webinar.scheduledDate)}}
            </div>
            <div class="flex items-center text-slate-300">
              <svg class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              {{webinar.duration}} minutes
            </div>
            <div class="flex items-center text-slate-300">
              <svg class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM9 3a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
              {{webinar.registrations || 0}}/{{webinar.maxAttendees}} registered
            </div>
            <div class="flex items-center text-slate-300">
              <svg class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              {{webinar.requireRegistration ? 'Registration Required' : 'Open Access'}}
            </div>
          </div>
        </div>
        
        <div class="flex-shrink-0 space-y-2">
          <button ng-click="copyWebinarLink()" 
                  class="w-full bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded-lg font-medium transition-colors">
            Copy Join Link
          </button>
          <button ng-click="editWebinar()" 
                  class="w-full bg-primary-600 hover:bg-primary-500 text-white px-4 py-2 rounded-lg font-medium transition-colors">
            Edit Webinar
          </button>
        </div>
      </div>
    </div>

    <!-- Main Content Tabs -->
    <div class="bg-slate-800 rounded-xl border border-slate-600 overflow-hidden">
      
      <!-- Tab Navigation -->
      <div class="border-b border-slate-700 bg-slate-900">
        <!-- Desktop Navigation -->
        <div class="hidden lg:flex">
          <button ng-click="debugTabClick('overview')" 
                  ng-class="activeTab === 'overview' ? 'bg-slate-800 text-white border-primary-500' : 'text-slate-300 hover:text-white'"
                  class="flex-1 px-6 py-4 font-medium border-b-2 border-transparent transition-colors">
            Overview
          </button>
          <button ng-click="debugTabClick('video')" 
                  ng-class="activeTab === 'video' ? 'bg-slate-800 text-white border-primary-500' : 'text-slate-300 hover:text-white'"
                  class="flex-1 px-6 py-4 font-medium border-b-2 border-transparent transition-colors">
            Video Upload
          </button>
          <button ng-click="debugTabClick('forms')" 
                  ng-class="activeTab === 'forms' ? 'bg-slate-800 text-white border-primary-500' : 'text-slate-300 hover:text-white'"
                  class="flex-1 px-6 py-4 font-medium border-b-2 border-transparent transition-colors">
            Registration Form
          </button>
          <button ng-click="debugTabClick('attendees')" 
                  ng-class="activeTab === 'attendees' ? 'bg-slate-800 text-white border-primary-500' : 'text-slate-300 hover:text-white'"
                  class="flex-1 px-6 py-4 font-medium border-b-2 border-transparent transition-colors">
            Attendees ({{webinar.registrations || 0}})
          </button>
          <button ng-click="debugTabClick('messages')" 
                  ng-class="activeTab === 'messages' ? 'bg-slate-800 text-white border-primary-500' : 'text-slate-300 hover:text-white'"
                  class="flex-1 px-6 py-4 font-medium border-b-2 border-transparent transition-colors">
            Automated Messages
          </button>
          <button ng-click="debugTabClick('analytics')" 
                  ng-class="activeTab === 'analytics' ? 'bg-slate-800 text-white border-primary-500' : 'text-slate-300 hover:text-white'"
                  class="flex-1 px-6 py-4 font-medium border-b-2 border-transparent transition-colors">
            Analytics
          </button>
          <button ng-click="debugTabClick('settings')" 
                  ng-class="activeTab === 'settings' ? 'bg-slate-800 text-white border-primary-500' : 'text-slate-300 hover:text-white'"
                  class="flex-1 px-6 py-4 font-medium border-b-2 border-transparent transition-colors">
            Settings
          </button>
        </div>
        
        <!-- Mobile Navigation -->
        <div class="lg:hidden">
          <select ng-model="activeTab" ng-change="debugMobileSelect()"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-600 text-white rounded-none focus:ring-2 focus:ring-primary-500">
            <option value="overview">Overview</option>
            <option value="video">Video Upload</option>
            <option value="forms">Registration Form</option>
            <option value="attendees">Attendees ({{webinar.registrations || 0}})</option>
            <option value="messages">Automated Messages</option>
            <option value="analytics">Analytics</option>
            <option value="settings">Settings</option>
          </select>
        </div>
      </div>

      <!-- Tab Content -->
      <div class="p-6">
        
        <!-- Overview Tab -->
        <div ng-if="activeTab === 'overview'">
          <h3 class="text-xl font-bold text-white mb-6">Webinar Overview</h3>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- Basic Information -->
            <div class="bg-slate-700 rounded-lg p-4 border border-slate-600">
              <h4 class="text-lg font-semibold text-white mb-4">Basic Information</h4>
              <div class="space-y-3">
                <div>
                  <span class="text-slate-300 text-sm">Title:</span>
                  <p class="text-white font-medium">{{webinar.title}}</p>
                </div>
                <div>
                  <span class="text-slate-300 text-sm">Description:</span>
                  <p class="text-white">{{webinar.description}}</p>
                </div>
                <div>
                  <span class="text-slate-300 text-sm">Created:</span>
                  <p class="text-white">{{formatDateTime(webinar.createdAt)}}</p>
                </div>
                <div ng-if="webinar.updatedAt !== webinar.createdAt">
                  <span class="text-slate-300 text-sm">Last Updated:</span>
                  <p class="text-white">{{formatDateTime(webinar.updatedAt)}}</p>
                </div>
              </div>
            </div>

            <!-- Schedule Information -->
            <div class="bg-slate-700 rounded-lg p-4 border border-slate-600">
              <h4 class="text-lg font-semibold text-white mb-4">Schedule & Capacity</h4>
              <div class="space-y-3">
                <div>
                  <span class="text-slate-300 text-sm">Scheduled Date:</span>
                  <p class="text-white font-medium">{{formatDateTime(webinar.scheduledDate)}}</p>
                </div>
                <div>
                  <span class="text-slate-300 text-sm">Duration:</span>
                  <p class="text-white">{{webinar.duration}} minutes</p>
                </div>
                <div>
                  <span class="text-slate-300 text-sm">Max Attendees:</span>
                  <p class="text-white">{{webinar.maxAttendees}}</p>
                </div>
                <div>
                  <span class="text-slate-300 text-sm">Current Registrations:</span>
                  <p class="text-white font-medium">{{webinar.registrations || 0}}</p>
                </div>
              </div>
            </div>

            <!-- Join Information -->
            <div class="bg-slate-700 rounded-lg p-4 border border-slate-600">
              <h4 class="text-lg font-semibold text-white mb-4">Join Information</h4>
              <div class="space-y-3">
                <div>
                  <span class="text-slate-300 text-sm">Webinar ID:</span>
                  <p class="text-white font-mono text-sm">{{webinar.id}}</p>
                </div>
                <div>
                  <span class="text-slate-300 text-sm">Registration Required:</span>
                  <p class="text-white">{{webinar.requireRegistration ? 'Yes' : 'No'}}</p>
                </div>
              </div>
            </div>

            <!-- Quick Stats -->
            <div class="bg-slate-700 rounded-lg p-4 border border-slate-600">
              <h4 class="text-lg font-semibold text-white mb-4">Quick Stats</h4>
              <div class="grid grid-cols-2 gap-4">
                <div class="text-center">
                  <div class="text-2xl font-bold text-green-400">{{webinar.registrations || 0}}</div>
                  <div class="text-slate-300 text-sm">Registered</div>
                </div>
                <div class="text-center">
                  <div class="text-2xl font-bold text-slate-400">{{webinar.maxAttendees - (webinar.registrations || 0)}}</div>
                  <div class="text-slate-300 text-sm">Available</div>
                </div>
              </div>
            </div>
            
          </div>
        </div>

        <!-- Video Upload Tab -->
        <div ng-if="activeTab === 'video'">
          <h3 class="text-xl font-bold text-white mb-6">Video Upload</h3>
          
          <!-- Video Upload Area -->
          <div class="bg-slate-700 rounded-lg p-6 border border-slate-600 text-center">
            <div ng-if="!webinar.videoFile">
              <div class="border-2 border-dashed border-blue-500 rounded-lg p-8">
                <svg class="mx-auto h-12 w-12 text-slate-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                  <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <div class="text-white font-medium mb-2">Upload Webinar Video</div>
                <div class="text-slate-300 text-sm mb-4">Drag and drop your video file here, or click to browse</div>
                <input type="file" accept="video/*" ng-file-select="onVideoSelect($files)" 
                       class="hidden" id="videoUpload">
                <label for="videoUpload" 
                       class="cursor-pointer bg-primary-600 hover:bg-primary-500 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                  Choose Video File
                </label>
                <div class="text-slate-400 text-xs mt-2">
                  Supported formats: MP4, MOV, AVI (Max size: 500MB)
                </div>
              </div>
            </div>
            
            <!-- Video Preview -->
            <div ng-if="webinar.videoFile" class="text-left">
              <div class="bg-slate-800 rounded-lg p-4 border border-slate-600 mb-4">
                <div class="flex items-center justify-between mb-4">
                  <h4 class="text-lg font-semibold text-white">Current Video</h4>
                  <button ng-click="removeVideo()" 
                          class="bg-red-600 hover:bg-red-500 text-white px-3 py-1 rounded text-sm transition-colors">
                    Remove
                  </button>
                </div>
                
                <!-- Video Player -->
                <div class="mb-4" ng-if="webinar.videoFile && webinar.videoFile.filename">
                  <div class="bg-black rounded-lg p-2">
                    <video controls 
                           class="w-full max-w-md rounded-lg" 
                           style="max-height: 300px;"
                           ng-src="{{getVideoUrl(webinar.videoFile)}}"
                           id="webinar-video-{{webinar.id}}">
                      Your browser does not support the video tag.
                    </video>
                    
                    <!-- Fallback download link -->
                    <div class="mt-2 text-center">
                      <a ng-href="{{getVideoUrl(webinar.videoFile)}}" 
                         class="text-primary-400 hover:text-primary-300 text-sm underline"
                         target="_blank">
                        Download video file
                      </a>
                    </div>
                  </div>
                </div>
                
                <div class="text-slate-300 text-sm">
                  <p><strong>File:</strong> {{webinar.videoFile.originalName}}</p>
                  <p><strong>Size:</strong> {{formatFileSize(webinar.videoFile.size)}}</p>
                  <p><strong>Uploaded:</strong> {{formatDateTime(webinar.videoFile.uploadedAt)}}</p>
                </div>
              </div>
              
              <!-- Replace Video -->
              <div class="border border-slate-600 rounded-lg p-4">
                <div class="text-white font-medium mb-2">Replace Video</div>
                <input type="file" accept="video/*" ng-file-select="onVideoSelect($files)" 
                       class="hidden" id="videoReplace">
                <label for="videoReplace" 
                       class="cursor-pointer bg-primary-600 hover:bg-primary-500 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                  Choose New Video
                </label>
              </div>
            </div>
            
            <!-- Upload Progress -->
            <div ng-if="uploadProgress" class="mt-4">
              <div class="text-white font-medium mb-2">Uploading... {{uploadProgress.percent}}%</div>
              <div class="w-full bg-slate-800 rounded-full h-2">
                <div class="bg-green-600 h-2 rounded-full transition-all duration-300" 
                     ng-style="{'width': uploadProgress.percent + '%'}"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Registration Form Builder Tab -->
        <div ng-if="activeTab === 'forms'">
          <h3 class="text-xl font-bold text-white mb-6">Registration Form Builder</h3>
          
          <!-- Form Preview -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- Current Registration Form -->
            <div class="bg-slate-700 rounded-lg p-6 border border-slate-600">
              <h4 class="text-lg font-semibold text-white mb-4">Current Registration Form</h4>
              
              <div class="space-y-4">
                <!-- Required Fields Preview -->
                <div class="border border-slate-600 rounded-lg p-4 bg-slate-800">
                  <h5 class="text-white font-medium mb-3">Default Required Fields</h5>
                  <div class="space-y-2 text-sm">
                    <div class="flex items-center text-slate-300">
                      <span class="w-2 h-2 bg-blue-400 rounded-full mr-2"></span>
                      Full Name (required)
                    </div>
                    <div class="flex items-center text-slate-300">
                      <span class="w-2 h-2 bg-blue-400 rounded-full mr-2"></span>
                      Email Address (required)
                    </div>
                    <div class="flex items-center text-slate-300">
                      <span class="w-2 h-2 bg-blue-400 rounded-full mr-2"></span>
                      Company/Organization (optional)
                    </div>
                  </div>
                </div>
                
                <!-- Custom Fields Preview -->
                <div class="border border-slate-600 rounded-lg p-4 bg-slate-800">
                  <h5 class="text-white font-medium mb-3">Custom Fields</h5>
                  <div ng-if="!webinar.customFields || webinar.customFields.length === 0" 
                       class="text-slate-400 text-sm italic">
                    No custom fields added yet
                  </div>
                  <div ng-if="webinar.customFields && webinar.customFields.length > 0" 
                       class="space-y-2">
                    <div ng-repeat="field in webinar.customFields" 
                         class="flex items-center justify-between text-slate-300 text-sm">
                      <span>{{field.label}} ({{field.type}})</span>
                      <button ng-click="askRemoveCustomField($index)" 
                              class="text-red-400 hover:text-red-300" aria-label="Remove custom field">
                        √ó
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Form Builder Tools -->
            <div class="bg-slate-700 rounded-lg p-6 border border-slate-600">
              <h4 class="text-lg font-semibold text-white mb-4">Add Custom Fields</h4>
              
              <div class="space-y-4">
                <!-- Field Type Selection -->
                <div>
                  <label class="block text-sm font-medium text-slate-300 mb-2">Field Type</label>
                  <select ng-model="newField.type" 
                          class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white">
                    <option value="text">Text Input</option>
                    <option value="textarea">Text Area</option>
                    <option value="select">Dropdown</option>
                    <option value="radio">Radio Buttons</option>
                    <option value="checkbox">Checkboxes</option>
                    <option value="number">Number</option>
                    <option value="phone">Phone Number</option>
                    <option value="url">Website URL</option>
                  </select>
                </div>
                
                <!-- Field Label -->
                <div>
                  <label class="block text-sm font-medium text-slate-300 mb-2">Field Label</label>
                  <input type="text" ng-model="newField.label" 
                         placeholder="e.g., Job Title, Industry, Experience Level"
                         class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-blue-400">
                </div>
                
                <!-- Field Options (for select, radio, checkbox) -->
                <div ng-if="newField.type === 'select' || newField.type === 'radio' || newField.type === 'checkbox'">
                  <label class="block text-sm font-medium text-slate-300 mb-2">Options (one per line)</label>
                  <textarea ng-model="newField.options" rows="3" 
                            placeholder="Option 1&#10;Option 2&#10;Option 3"
                            class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-blue-400"></textarea>
                </div>
                
                <!-- Required Field -->
                <div class="flex items-center">
                  <input type="checkbox" ng-model="newField.required" id="fieldRequired" 
                         class="w-4 h-4 text-blue-600 bg-slate-800 border-slate-600 rounded">
                  <label for="fieldRequired" class="ml-2 text-sm text-slate-300">
                    Required field
                  </label>
                </div>
                
                <!-- Add Field Button -->
                <button ng-click="addCustomField()" ng-disabled="!newField.label || !newField.type"
                        class="w-full bg-green-600 hover:bg-green-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white py-2 px-4 rounded-lg font-medium transition-colors">
                  Add Field
                </button>
                
                <!-- Preview Field -->
                <div ng-if="newField.label && newField.type" 
                     class="border border-slate-600 rounded-lg p-3 bg-slate-800">
                  <h6 class="text-sm font-medium text-slate-300 mb-2">Preview:</h6>
                  <div class="space-y-2">
                    <label class="block text-sm text-white">
                      {{newField.label}}{{newField.required ? ' *' : ''}}
                    </label>
                    
                    <!-- Text Input Preview -->
          <input ng-if="newField.type === 'text' || newField.type === 'number' || newField.type === 'phone' || newField.type === 'url'" 
            type="{{newField.type === 'number' ? 'number' : (newField.type === 'phone' ? 'tel' : (newField.type === 'url' ? 'url' : 'text'))}}"
                           disabled
                           class="w-full px-2 py-1 bg-slate-900 border border-slate-600 rounded text-white text-sm">
                    
                    <!-- Textarea Preview -->
                    <textarea ng-if="newField.type === 'textarea'" rows="2" disabled
                              class="w-full px-2 py-1 bg-slate-900 border border-slate-600 rounded text-white text-sm"></textarea>
                    
                    <!-- Select Preview -->
                    <select ng-if="newField.type === 'select'" disabled
                            class="w-full px-2 py-1 bg-slate-900 border border-slate-600 rounded text-white text-sm">
                      <option ng-repeat="option in getFieldOptions(newField.options)">{{option}}</option>
                    </select>
                    
                    <!-- Radio Preview -->
                    <div ng-if="newField.type === 'radio'" class="space-y-1">
                      <div ng-repeat="option in getFieldOptions(newField.options)" class="flex items-center">
                        <input type="radio" disabled class="w-3 h-3 text-blue-600">
                        <label class="ml-2 text-sm text-white">{{option}}</label>
                      </div>
                    </div>
                    
                    <!-- Checkbox Preview -->
                    <div ng-if="newField.type === 'checkbox'" class="space-y-1">
                      <div ng-repeat="option in getFieldOptions(newField.options)" class="flex items-center">
                        <input type="checkbox" disabled class="w-3 h-3 text-blue-600">
                        <label class="ml-2 text-sm text-white">{{option}}</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Form Settings -->
          <div class="mt-6 bg-slate-700 rounded-lg p-6 border border-slate-600">
            <h4 class="text-lg font-semibold text-white mb-4">Form Settings</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Registration Confirmation Message</label>
                <textarea ng-model="webinar.confirmationMessage" rows="3" 
                          placeholder="Thank you for registering! You will receive a confirmation email shortly."
                          class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-blue-400"></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Registration Deadline</label>
                <input type="datetime-local" ng-model="webinar.registrationDeadline"
                       class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white">
                <div class="text-xs text-slate-400 mt-1">Leave empty for no deadline</div>
              </div>
            </div>
            
            <div class="mt-4 flex justify-end">
              <button ng-click="saveFormSettings()" ng-disabled="isUpdating"
                      class="bg-primary-600 hover:bg-primary-500 disabled:bg-gray-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                {{isUpdating ? 'Saving...' : 'Save Form Settings'}}
              </button>
            </div>
          </div>
        </div>

        <!-- Attendees Tab -->
        <div ng-if="activeTab === 'attendees'">
     <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold text-white">Attendees</h3>
            <button ng-click="exportAttendees()" 
                    class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg font-medium transition-colors">
              Export CSV
            </button>
          </div>
          
     <!-- Search & Filters -->
     <div class="mb-4 grid grid-cols-1 md:grid-cols-3 gap-3">
            <input type="text" ng-model="attendeeFilters.search" ng-change="filterAttendees()"
         placeholder="Search name, email, company, or custom fields..."
         class="px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-blue-400 focus:ring-2 focus:ring-blue-500">
            <select ng-model="attendeeFilters.status" ng-change="filterAttendees()"
          class="px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white">
    <option value="">All Statuses</option>
    <option value="registered">Registered</option>
    <option value="pending">Pending</option>
    <option value="cancelled">Cancelled</option>
       </select>
            <input type="text" ng-model="attendeeFilters.company" ng-change="filterAttendees()"
         placeholder="Filter by company"
         class="px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-blue-400 focus:ring-2 focus:ring-blue-500">
     </div>

          <!-- Attendees List -->
          <div ng-if="attendees.length > 0" class="bg-slate-700 rounded-lg border border-slate-600 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-slate-800">
                  <tr>
                    <th class="px-4 py-3 text-left text-slate-300 text-sm font-medium">Name</th>
                    <th class="px-4 py-3 text-left text-slate-300 text-sm font-medium">Email</th>
                    <th class="px-4 py-3 text-left text-slate-300 text-sm font-medium">Company</th>
                    <th class="px-4 py-3 text-left text-slate-300 text-sm font-medium">Registered</th>
                    <th class="px-4 py-3 text-left text-slate-300 text-sm font-medium">Status</th>
                    <!-- Dynamic custom field columns (union of configured and historical labels) -->
                    <th class="px-4 py-3 text-left text-slate-300 text-sm font-medium" 
                        ng-repeat="label in customFieldColumns">
                      {{label}}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="attendee in filteredAttendees" class="border-t border-slate-600 hover:bg-primary-600">
                    <td class="px-4 py-3 text-white">{{attendee.name}}</td>
                    <td class="px-4 py-3 text-slate-300">{{attendee.email}}</td>
                    <td class="px-4 py-3 text-slate-300">{{attendee.company || '-'}}</td>
                    <td class="px-4 py-3 text-slate-300">{{formatDateTime(attendee.registeredAt)}}</td>
                    <td class="px-4 py-3">
                      <span class="px-2 py-1 text-xs rounded-full bg-green-800 text-green-200">
                        {{attendee.status}}
                      </span>
                    </td>
                    <!-- Column cells for each custom field label -->
                    <td class="px-4 py-3 text-slate-200" ng-repeat="label in customFieldColumns">
                      {{ (attendee.customFields && (attendee.customFields[label])) || '-' }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- No Attendees -->
          <div ng-if="attendees.length === 0" class="text-center py-8">
            <div class="text-slate-300 mb-4">No attendees registered yet</div>
            <button ng-click="copyWebinarLink()" 
                    class="bg-purple-600 hover:bg-purple-500 text-white px-6 py-2 rounded-lg font-medium transition-colors">
              Copy Join Link to Share
            </button>
          </div>
        </div>

        <!-- Automated Messages Tab -->
        <div ng-if="activeTab === 'messages'">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold text-white">Automated Messages</h3>
            <button ng-click="openMessageScheduler()" 
                    class="bg-primary-600 hover:bg-primary-500 text-white px-6 py-3 rounded-lg font-medium transition-colors">
              üïí Schedule Messages
            </button>
          </div>
          
          <div class="bg-slate-700 rounded-lg p-6 border border-slate-600 mb-6">
            <p class="text-slate-300 mb-4">
              Set up automated messages to be sent to participants at specific times during your webinar. 
              Messages will only be delivered after the scheduled webinar start time.
            </p>
            
            <!-- Current Scheduled Messages -->
            <div ng-if="scheduledMessages.length > 0">
              <h4 class="text-white font-semibold mb-4">Current Scheduled Messages ({{scheduledMessages.length}})</h4>
              
              <div class="space-y-3">
                <div ng-repeat="message in scheduledMessages" 
                     class="bg-slate-800 rounded-lg p-4 border border-slate-600">
                  <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center space-x-3">
                      <span class="bg-primary-600 text-white text-xs px-2 py-1 rounded">
                        {{formatTimeDisplay(message.atSeconds)}}
                      </span>
                      <span class="bg-slate-600 text-slate-300 text-xs px-2 py-1 rounded">
                        {{message.type || 'text'}}
                      </span>
                    </div>
                    
                    <!-- Edit and Delete Actions -->
                    <div class="flex gap-2">
                      <button ng-click="editSingleMessage(message)" 
                              class="text-blue-400 hover:text-blue-300 text-sm px-2 py-1 rounded border border-blue-500 hover:bg-blue-500/10 transition-colors"
                              title="Edit Message">
                        ‚úèÔ∏è Edit
                      </button>
                      <button ng-click="deleteSingleMessage(message.id)" 
                              class="text-red-400 hover:text-red-300 text-sm px-2 py-1 rounded border border-red-500 hover:bg-red-500/10 transition-colors"
                              title="Delete Message">
                        üóëÔ∏è Delete
                      </button>
                    </div>
                  </div>
                  
                  <div class="text-white mb-2">{{message.text}}</div>
                  
                  <!-- CTA Buttons Preview -->
                  <div ng-if="message.type === 'cta' && message.buttons.length > 0" class="flex gap-2 mb-2">
                    <span ng-repeat="btn in message.buttons" 
                          class="bg-primary-600 text-white text-xs px-3 py-1 rounded">
                      {{btn.label}}
                    </span>
                  </div>
                  
                  <!-- Image Preview -->
                  <div ng-if="message.type === 'image' && message.imageUrl" class="mb-2">
                    <img ng-src="{{message.imageUrl}}" alt="message image" 
                         class="h-16 w-auto rounded border border-slate-600" />
                  </div>
                </div>
              </div>
            </div>
            
            <!-- No Messages -->
            <div ng-if="scheduledMessages.length === 0" class="text-center py-8">
              <div class="text-slate-400 mb-4">No automated messages scheduled yet</div>
              <button ng-click="openMessageScheduler()" 
                      class="bg-primary-600 hover:bg-primary-500 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                Create Your First Automated Message
              </button>
            </div>
          </div>
        </div>

        <!-- Analytics Tab -->
        <div ng-if="activeTab === 'analytics'">
          <h3 class="text-xl font-bold text-white mb-6">Analytics & Insights</h3>
          
          <!-- Key Metrics -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            
            <!-- Total Registrations -->
            <div class="bg-slate-700 rounded-lg p-4 border border-slate-600">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-slate-300 text-sm">Total Registrations</p>
                  <p class="text-white text-2xl font-bold">{{webinar.registrations || 0}}</p>
                </div>
                <div class="text-green-400">
                  <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
              </div>
              <div class="text-slate-400 text-xs mt-2">
                {{((webinar.registrations || 0) / webinar.maxAttendees * 100).toFixed(1)}}% of capacity
              </div>
            </div>
            
            <!-- Capacity Utilization -->
            <div class="bg-slate-700 rounded-lg p-4 border border-slate-600">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-slate-300 text-sm">Available Spots</p>
                  <p class="text-white text-2xl font-bold">{{webinar.maxAttendees - (webinar.registrations || 0)}}</p>
                </div>
                <div class="text-slate-400">
                  <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                  </svg>
                </div>
              </div>
              <div class="text-slate-400 text-xs mt-2">
                Max capacity: {{webinar.maxAttendees}}
              </div>
            </div>
            
            <!-- Days Until Webinar -->
            <div class="bg-slate-700 rounded-lg p-4 border border-slate-600">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-slate-300 text-sm">Days Until Event</p>
                  <p class="text-white text-2xl font-bold">{{getDaysUntilWebinar()}}</p>
                </div>
                <div class="text-yellow-400">
                  <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </div>
              <div class="text-slate-400 text-xs mt-2">
                {{webinar.scheduledDate | date:'short'}}
              </div>
            </div>
            
            <!-- Registration Rate -->
            <div class="bg-slate-700 rounded-lg p-4 border border-slate-600">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-slate-300 text-sm">Avg. Daily Registrations</p>
                  <p class="text-white text-2xl font-bold">{{getAvgDailyRegistrations()}}</p>
                </div>
                <div class="text-purple-400">
                  <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                  </svg>
                </div>
              </div>
              <div class="text-slate-400 text-xs mt-2">
                Based on registration timeline
              </div>
            </div>
          </div>
          
          <!-- Registration Progress -->
          <div class="bg-slate-700 rounded-lg p-6 border border-slate-600 mb-6">
            <h4 class="text-lg font-semibold text-white mb-4">Registration Progress</h4>
            
            <!-- Progress Bar -->
            <div class="mb-4">
              <div class="flex justify-between text-sm text-slate-300 mb-2">
                <span>{{webinar.registrations || 0}} / {{webinar.maxAttendees}} registered</span>
                <span>{{((webinar.registrations || 0) / webinar.maxAttendees * 100).toFixed(1)}}%</span>
              </div>
              <div class="w-full bg-slate-800 rounded-full h-3">
                <div class="bg-gradient-to-r from-green-500 to-blue-500 h-3 rounded-full transition-all duration-500" 
                     ng-style="{'width': ((webinar.registrations || 0) / webinar.maxAttendees * 100) + '%'}"></div>
              </div>
            </div>
            
            <!-- Registration Status -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="text-center">
                <div class="text-green-400 text-2xl font-bold">{{getRegistrationsByStatus('registered')}}</div>
                <div class="text-slate-300 text-sm">Confirmed</div>
              </div>
              <div class="text-center">
                <div class="text-yellow-400 text-2xl font-bold">{{getRegistrationsByStatus('pending')}}</div>
                <div class="text-slate-300 text-sm">Pending</div>
              </div>
              <div class="text-center">
                <div class="text-red-400 text-2xl font-bold">{{getRegistrationsByStatus('cancelled')}}</div>
                <div class="text-slate-300 text-sm">Cancelled</div>
              </div>
            </div>
          </div>
          
          <!-- Registration Timeline -->
          <div class="bg-slate-700 rounded-lg p-6 border border-slate-600 mb-6">
            <h4 class="text-lg font-semibold text-white mb-4">Registration Timeline</h4>
            
            <div ng-if="attendees.length === 0" class="text-slate-400 text-center py-8">
              No registrations yet
            </div>
            
            <div ng-if="attendees.length > 0" class="space-y-3">
              <div ng-repeat="day in getRegistrationTimeline() | orderBy:'-date'" 
                   class="flex items-center justify-between p-3 bg-slate-800 rounded-lg">
                <div>
                  <div class="text-white font-medium">{{day.date | date:'mediumDate'}}</div>
                  <div class="text-slate-300 text-sm">{{day.count}} registration{{day.count !== 1 ? 's' : ''}}</div>
                </div>
                <div class="w-32 bg-slate-900 rounded-full h-2">
                  <div class="bg-primary-500 h-2 rounded-full" 
                       ng-style="{'width': (day.count / getMaxDailyRegistrations() * 100) + '%'}"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Company Analysis -->
          <div ng-if="attendees.length > 0" class="bg-slate-700 rounded-lg p-6 border border-slate-600">
            <h4 class="text-lg font-semibold text-white mb-4">Company Analysis</h4>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              
              <!-- Top Companies -->
              <div>
                <h5 class="text-white font-medium mb-3">Top Companies</h5>
                <div class="space-y-2">
                  <div ng-repeat="company in getTopCompanies() | limitTo:5" 
                       class="flex items-center justify-between p-2 bg-slate-800 rounded">
                    <span class="text-white">{{company.name || 'Not specified'}}</span>
                    <span class="text-slate-300 text-sm">{{company.count}} attendee{{company.count !== 1 ? 's' : ''}}</span>
                  </div>
                </div>
              </div>
              
              <!-- Registration Sources -->
              <div>
                <h5 class="text-white font-medium mb-3">Recent Registrations</h5>
                <div class="space-y-2">
                  <div ng-repeat="attendee in attendees | orderBy:'-registeredAt' | limitTo:5" 
                       class="flex items-center justify-between p-2 bg-slate-800 rounded">
                    <div>
                      <div class="text-white text-sm">{{attendee.name}}</div>
                      <div class="text-slate-300 text-xs">{{attendee.company || 'No company'}}</div>
                    </div>
                    <div class="text-slate-400 text-xs">
                      {{formatDateTime(attendee.registeredAt)}}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Tab -->
        <div ng-if="activeTab === 'settings'">
          <h3 class="text-xl font-bold text-white mb-6">Webinar Settings</h3>
          
          <!-- Edit Form -->
          <form ng-submit="updateWebinar()" class="space-y-6">
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Webinar Title *</label>
                <input type="text" ng-model="editForm.title" required
                       class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-primary-500">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Scheduled Date & Time * (local time)</label>
                <input type="datetime-local" 
                       ng-model="editForm.scheduledDateTime" 
                       required
                       class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-primary-500">
              </div>
              
            </div>
            
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Description *</label>
              <textarea ng-model="editForm.description" required rows="4"
                        class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-primary-500"></textarea>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Duration (minutes) *</label>
                <input type="number" ng-model="editForm.duration" required min="15" max="480"
                       class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-primary-500">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Max Attendees *</label>
                <input type="number" ng-model="editForm.maxAttendees" required min="1" max="10000"
                       class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-primary-500">
              </div>
              
              <div class="flex items-center pt-6">
                <input type="checkbox" ng-model="editForm.requireRegistration" id="requireReg"
                       class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-slate-600 rounded">
                <label for="requireReg" class="ml-2 text-slate-300">
                  Require registration to join
                </label>
              </div>
              
            </div>
            
            <div class="flex space-x-4 pt-4">
              <button type="submit" ng-disabled="isUpdating"
                      class="bg-primary-600 hover:bg-primary-500 text-white py-2 px-6 rounded-lg font-medium disabled:opacity-50 transition-colors">
                <span ng-if="!isUpdating">Update Webinar</span>
                <span ng-if="isUpdating">Updating...</span>
              </button>
              <button type="button" ng-click="resetEditForm()"
                      class="bg-slate-700 hover:bg-primary-600 text-white py-2 px-6 rounded-lg font-medium transition-colors">
                Reset
              </button>
            </div>
            
          </form>
        </div>
        
      </div>
    </div>
  </div>

  <!-- Confirm Remove Custom Field Modal -->
  <div ng-if="removeFieldModal.open" class="fixed inset-0 z-50 flex items-center justify-center">
    <div class="absolute inset-0 bg-black bg-opacity-50" ng-click="cancelRemoveCustomField()"></div>
    <div class="relative bg-slate-800 border border-slate-600 rounded-lg shadow-xl max-w-sm w-full mx-4 p-5">
      <h4 class="text-white text-lg font-semibold mb-2">Remove Custom Field?</h4>
      <p class="text-slate-300 text-sm mb-4">Are you sure you want to remove "{{removeFieldModal.label}}" from the registration form?</p>
      <div class="flex justify-end space-x-3">
        <button class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded" ng-click="cancelRemoveCustomField()">Cancel</button>
        <button class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded" ng-click="confirmRemoveCustomField()">Remove</button>
      </div>
    </div>
  </div>

  <!-- Message Scheduler Modal -->
  <div ng-if="messageScheduler.open" class="fixed inset-0 z-50 bg-black bg-opacity-60 overflow-y-auto">
    <div class="min-h-screen flex items-start sm:items-center justify-center p-2 sm:p-4">
      <div class="bg-slate-900 border border-slate-700 rounded-lg w-full max-w-sm sm:max-w-2xl lg:max-w-5xl shadow-xl max-h-[98vh] sm:max-h-[90vh] overflow-hidden flex flex-col my-2 sm:my-4">
      
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-3 sm:p-4 border-b border-slate-700 flex-shrink-0">
        <h3 class="text-white font-semibold text-base sm:text-lg">Schedule Automated Messages</h3>
        <button class="text-slate-300 hover:text-white text-lg sm:text-xl" ng-click="closeMessageScheduler()">‚úï</button>
      </div>
      
      <!-- Modal Content -->
      <div class="flex flex-col lg:flex-row flex-1 min-h-0">
        
        <!-- Video Preview Section -->
        <div class="w-full lg:w-1/2 bg-black border-b lg:border-b-0 lg:border-r border-slate-700 flex flex-col min-h-0">
          <div class="p-3 sm:p-4 border-b border-slate-700 flex-shrink-0">
            <h4 class="text-white font-medium mb-2 text-sm sm:text-base">Video Preview</h4>
            <p class="text-slate-400 text-xs sm:text-sm">Pause the video at the exact time you want to send a message</p>
          </div>
          
          <div class="flex-1 flex items-center justify-center p-2 sm:p-4 min-h-0">
            <div ng-if="messageScheduler.videoUrl" class="w-full">
              <video id="schedulerVideo" 
                     class="w-full h-auto max-h-48 sm:max-h-64 lg:max-h-96 bg-black rounded" 
                     controls 
                     preload="metadata"
                     ng-src="{{messageScheduler.videoUrl}}">
                Your browser does not support the video tag.
              </video>
              
              <div class="mt-2 text-center">
                <span class="text-slate-400 text-xs sm:text-sm">Current Time: </span>
                <span class="text-white font-mono text-xs sm:text-sm">{{formatTimeDisplay(getCurrentVideoTime())}}</span>
              </div>
            </div>
            
            <div ng-if="!messageScheduler.videoUrl" class="text-center text-slate-400">
              <svg class="w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M2 6a2 2 0 012-2h6l2 2h6a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"></path>
              </svg>
              <p class="text-sm sm:text-base">No video uploaded yet</p>
              <p class="text-xs sm:text-sm">Upload a video in the Video tab first</p>
            </div>
          </div>
        </div>
        
        <!-- Messages Configuration Section -->
        <div class="w-full lg:w-1/2 flex flex-col min-h-0">
          <div class="p-3 sm:p-4 border-b border-slate-700 flex-shrink-0">
            <h4 class="text-white font-medium mb-3 text-sm sm:text-base">Add Messages</h4>
            <div class="flex gap-2 flex-wrap">
              <button class="bg-primary-600 hover:bg-primary-700 text-white px-3 py-1.5 rounded text-xs sm:text-sm font-medium" 
                      ng-click="addTextMessage()">üìù Text</button>
              <button class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-1.5 rounded text-xs sm:text-sm font-medium" 
                      ng-click="addCTAMessage()">üîó CTA</button>
              <button class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1.5 rounded text-xs sm:text-sm font-medium" 
                      ng-click="addImageMessage()">üì∑ Image</button>
            </div>
          </div>
          
          <!-- Messages List - Scrollable -->
          <div class="flex-1 overflow-y-auto p-2 sm:p-4 min-h-0" style="max-height: 50vh;">
            <div ng-if="messageScheduler.editing.length === 0" class="text-center text-slate-400 py-8">
              <p class="text-sm sm:text-base">No messages scheduled yet</p>
              <p class="text-xs sm:text-sm">Use the buttons above to add messages</p>
            </div>
            
            <div ng-repeat="message in messageScheduler.editing track by message.id" 
                 class="bg-slate-800 border border-slate-600 rounded-lg p-3 sm:p-4 mb-3 sm:mb-4">
              
              <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start mb-3 gap-2">
                <div class="flex flex-col sm:flex-row sm:items-center gap-2">
                  <select class="bg-slate-700 text-white text-xs sm:text-sm px-2 py-1 rounded border border-slate-600 w-full sm:w-auto" 
                          ng-model="message.type">
                    <option value="text">Text</option>
                    <option value="cta">CTA</option>
                    <option value="image">Image</option>
                  </select>
                  
                  <span class="text-slate-400 text-xs sm:text-sm">at</span>
                  
                  <div class="flex items-center gap-1 flex-wrap">
                    <input type="number" min="0" max="23"
                           class="bg-slate-700 text-white text-xs sm:text-sm px-1 sm:px-2 py-1 rounded border border-slate-600 w-12 sm:w-16" 
                           ng-model="message.hours" ng-change="updateMessageTime(message)" placeholder="0" />
                    <span class="text-slate-400 text-xs">h</span>
                    
                    <input type="number" min="0" max="59"
                           class="bg-slate-700 text-white text-xs sm:text-sm px-1 sm:px-2 py-1 rounded border border-slate-600 w-12 sm:w-16" 
                           ng-model="message.minutes" ng-change="updateMessageTime(message)" placeholder="0" />
                    <span class="text-slate-400 text-xs">m</span>
                    
                    <input type="number" min="0" max="59"
                           class="bg-slate-700 text-white text-xs sm:text-sm px-1 sm:px-2 py-1 rounded border border-slate-600 w-12 sm:w-16" 
                           ng-model="message.seconds" ng-change="updateMessageTime(message)" placeholder="0" />
                    <span class="text-slate-400 text-xs">s</span>
                  </div>
                </div>
                
                <button class="text-red-400 hover:text-red-300 self-end sm:self-start" 
                        ng-click="removeScheduledMessage(message.id)">‚úï</button>
              </div>
              
              <!-- Text Message -->
              <div ng-if="message.type === 'text'">
                <label class="block text-slate-400 text-xs sm:text-sm mb-1">Message Text</label>
                <textarea class="w-full bg-slate-700 text-white text-xs sm:text-sm p-2 rounded border border-slate-600" 
                          rows="2" ng-model="message.text" placeholder="Enter your message..."></textarea>
              </div>
              
              <!-- CTA Message -->
              <div ng-if="message.type === 'cta'">
                <label class="block text-slate-400 text-xs sm:text-sm mb-1">Message Text</label>
                <textarea class="w-full bg-slate-700 text-white text-xs sm:text-sm p-2 rounded border border-slate-600 mb-3" 
                          rows="2" ng-model="message.text" placeholder="Enter CTA message..."></textarea>
                
                <label class="block text-slate-400 text-xs sm:text-sm mb-1">Buttons</label>
                <div ng-repeat="button in message.buttons track by $index" class="flex flex-col sm:flex-row gap-2 mb-2">
                  <input class="flex-1 bg-slate-700 text-white text-xs sm:text-sm p-2 rounded border border-slate-600" 
                         ng-model="button.label" placeholder="Button text" />
                  <input class="flex-1 bg-slate-700 text-white text-xs sm:text-sm p-2 rounded border border-slate-600" 
                         ng-model="button.url" placeholder="https://..." />
                  <button class="text-red-400 hover:text-red-300 px-2 self-end sm:self-center" 
                          ng-click="removeCTAButton(message, $index)">‚úï</button>
                </div>
                <button class="text-primary-400 hover:text-primary-300 text-xs sm:text-sm" 
                        ng-click="addCTAButton(message)">+ Add Button</button>
              </div>
              
              <!-- Image Message -->
              <div ng-if="message.type === 'image'">
                <label class="block text-slate-400 text-xs sm:text-sm mb-1">Image URL</label>
                <input class="w-full bg-slate-700 text-white text-xs sm:text-sm p-2 rounded border border-slate-600 mb-3" 
                       ng-model="message.imageUrl" placeholder="https://..." />
                
                <label class="block text-slate-400 text-xs sm:text-sm mb-1">Caption (optional)</label>
                <textarea class="w-full bg-slate-700 text-white text-xs sm:text-sm p-2 rounded border border-slate-600" 
                          rows="2" ng-model="message.caption" placeholder="Image caption..."></textarea>
              </div>
              
            </div>
          </div>
        </div>
        
      </div>
      
      <!-- Modal Footer -->
      <div class="p-3 sm:p-4 border-t border-slate-700 flex flex-col sm:flex-row justify-end gap-2">
        <button class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded text-sm sm:text-base order-2 sm:order-1" 
                ng-click="closeMessageScheduler()">Cancel</button>
        <button class="px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded disabled:opacity-60 text-sm sm:text-base order-1 sm:order-2" 
                ng-disabled="messageScheduler.saving" ng-click="saveScheduledMessages()">
          <span ng-if="!messageScheduler.saving">Save Messages</span>
          <span ng-if="messageScheduler.saving">Saving...</span>
        </button>
      </div>
      
    </div>
  </div>

</div>

<!-- Delete Confirmation Modal (Completely outside main container) -->
<div ng-if="deleteConfirmation.open" 
     class="fixed top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-90 p-4"
     style="position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw !important; height: 100vh !important; z-index: 99999 !important;">
  <div class="bg-slate-900 border-2 border-red-500 rounded-lg w-full max-w-md shadow-2xl"
       style="position: relative !important; z-index: 100000 !important;">
    
    <!-- Modal Header -->
    <div class="p-4 border-b border-slate-700 bg-red-900/20">
      <h3 class="text-white font-semibold text-lg flex items-center">
        <span class="text-red-400 mr-2">‚ö†Ô∏è</span>
        {{deleteConfirmation.title}}
      </h3>
    </div>
    
    <!-- Modal Content -->
    <div class="p-4">
      <p class="text-slate-300 mb-4">{{deleteConfirmation.message}}</p>
    </div>
    
    <!-- Modal Footer -->
    <div class="p-4 border-t border-slate-700 flex justify-end gap-3">
      <button class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded font-medium" 
              ng-click="cancelDeleteMessage()">Cancel</button>
      <button class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-medium" 
              ng-click="confirmDeleteMessage()">Delete Message</button>
    </div>
    
  </div>
</div>
